<!DOCTYPE html><html lang="zh"><head><meta http-equiv=Content-Type content='text/html; charset=utf-8'>
<script>window.currentUser = null;</script><script>window.rateUsdToNative = 6.8872;</script><title itemprop="name">异常处理，&quot;try..catch&quot;</title><link href="pack/styles.9ab2708780c33bc8dadc.css" tppabs="https://zh.javascript.info/pack/styles.9ab2708780c33bc8dadc.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="../fonts.googleapis.com/css-family=Open+Sans-400italic,700italic,400,700-Open+Sans+Condensed-700&subset=latin,latin-ext,cyrillic,cyrillic-ext.css" tppabs="https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700%7COpen+Sans+Condensed:700&subset=latin,latin-ext,cyrillic,cyrillic-ext" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="/img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="https://zh.javascript.info/try-catch"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="/img/favicon/favicon.png"><meta itemprop="image" content="https://zh.javascript.info/img/site_preview_en_512x512.png"><meta property="og:title" content="异常处理，&quot;try..catch&quot;"><meta property="og:image" content="https://zh.javascript.info/img/site_preview_en_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="异常处理，&quot;try..catch&quot;"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://zh.javascript.info/img/site_preview_en_512x512.png"><link rel="prev" href="/error-handling"><link rel="next" href="/custom-errors"><script>window.GA_ID = "UA-2056213-15";</script><script>window.YANDEX_METRIKA_ID = 32184394;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="../www.google-analytics.com/analytics.js" tppabs="https://www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="../mc.yandex.ru/metrika/watch.js" tppabs="https://mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6Lf9NyETAAAAACZlg-a9Us2SxvYbeVC1ROWaWv4O";</script><script src="pack/init.9ab2708780c33bc8dadc.js" tppabs="https://zh.javascript.info/pack/init.9ab2708780c33bc8dadc.js"></script><script src="pack/head.9ab2708780c33bc8dadc.js" tppabs="https://zh.javascript.info/pack/head.9ab2708780c33bc8dadc.js" defer></script><meta property="og:title" content="异常处理，&quot;try..catch&quot;"><meta property="og:type" content="article"><script src="pack/tutorial.9ab2708780c33bc8dadc.js" tppabs="https://zh.javascript.info/pack/tutorial.9ab2708780c33bc8dadc.js" defer></script><script src="pack/footer.9ab2708780c33bc8dadc.js" tppabs="https://zh.javascript.info/pack/footer.9ab2708780c33bc8dadc.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if lt IE 10]><div style="color:red;text-align:center">很抱歉，我们不支持 IE&lt;10 等浏览器，请使用一个更新版本的浏览器。</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><div class="sitetoolbar__content"><div class="sitetoolbar__lang-switcher"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>ZH</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><div class="sitetoolbar__lang-switcher-body"><div class="supported-langs supported-langs_toolbar"><div class="supported-langs__text">我们希望将这个开源项目提供给全世界的人。请帮助我们将教程的内容 <a href="javascript:if(confirm('https://github.com/iliakan/javascript-tutorial-en  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/iliakan/javascript-tutorial-en'" tppabs="https://github.com/iliakan/javascript-tutorial-en" rel="noopener noreferrer" target="_blank">翻译为你所掌握的语言</a> 对应的版本。</div><div class="supported-langs__container"><ul class="supported-langs__list" style="height:128px"><li class="supported-langs__item"><a class="supported-langs__link" href="javascript:if(confirm('https://javascript.info/try-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://javascript.info/try-catch'" tppabs="https://javascript.info/try-catch"><span class="supported-langs__brief">EN</span><span class="supported-langs__title">English</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="javascript:if(confirm('https://learn.javascript.ru/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://learn.javascript.ru/'" tppabs="https://learn.javascript.ru/"><span class="supported-langs__brief">RU</span><span class="supported-langs__title">Русский</span></a></li><li class="supported-langs__item supported-langs__item_current"><a class="supported-langs__link" href="try-catch.htm" tppabs="https://zh.javascript.info/try-catch"><span class="supported-langs__brief">ZH</span><span class="supported-langs__title">简体中文</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="javascript:if(confirm('https://ja.javascript.info/try-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://ja.javascript.info/try-catch'" tppabs="https://ja.javascript.info/try-catch"><span class="supported-langs__brief">JA</span><span class="supported-langs__title">日本語</span></a></li></ul></div></div></div></div></div></div><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="index.htm" tppabs="https://zh.javascript.info/"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="img/sitetoolbar__logo_en.svg" tppabs="https://zh.javascript.info/img/sitetoolbar__logo_en.svg" width="200" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small" src="img/sitetoolbar__logo_small_en.svg" tppabs="https://zh.javascript.info/img/sitetoolbar__logo_small_en.svg" width="70" alt="" role="presentation"/><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"></ul></nav><div class="sitetoolbar__book-wrap"><a class="buy-book-button" href="ebook.htm" tppabs="https://zh.javascript.info/ebook"><span class="buy-book-button__extra-text">购买</span>EPUB/PDF</a></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><form class="sitetoolbar__search" method="GET" action="https://zh.javascript.info/search"><button class="sitetoolbar__search-toggle" type="button"></button><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" name="query" placeholder="在 Javascript.info 网站中搜索" required="required" type="text"/></div><button class="sitetoolbar__find" type="submit">搜索</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="https://zh.javascript.info/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="在教程中搜索" required="required"/><button class="tablet-menu-search__button" type="submit" name="type" value="articles">搜索</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="tutorial/map.htm" tppabs="https://zh.javascript.info/tutorial/map" data-action="tutorial-map"><span class="map__text">教程路线图</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">分享</span><a class="share share_tw" href="javascript:if(confirm('https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_fb" href="javascript:if(confirm('https://www.facebook.com/sharer/sharer.php?s=100&p%5Burl%5D=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.facebook.com/sharer/sharer.php?s=100&p%5Burl%5D=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://www.facebook.com/sharer/sharer.php?s=100&p%5Burl%5D=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_gp" href="javascript:if(confirm('https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_vk" href="javascript:if(confirm('https://vkontakte.ru/share.php?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://vkontakte.ru/share.php?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://vkontakte.ru/share.php?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="https://javascript.info/try-catch">English</option><option value="https://learn.javascript.ru/">Русский</option><option value="https://zh.javascript.info/try-catch" selected>简体中文</option><option value="https://ja.javascript.info/try-catch">日本語</option></select></div></div></div><progress class="tutorial-progress" data-sticky value="66" max="67" data-tooltip="第 67 章，第 66 节"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");var pageWrapper=document.querySelector(".page-wrapper");pageWrapper&&pageWrapper.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")},0);</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-1"><a class="breadcrumbs__link" href="index.htm" tppabs="https://zh.javascript.info/" itemprop="url"><span class="breadcrumbs__hidden-text" itemprop="title">教程</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-2" itemprop="child"><a class="breadcrumbs__link" href="js.htm" tppabs="https://zh.javascript.info/js" itemprop="url"><span itemprop="title">JavaScript 编程语言</span></a></li><li class="breadcrumbs__item" id="breadcrumb-2" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child"><a class="breadcrumbs__link" href="error-handling.htm" tppabs="https://zh.javascript.info/error-handling" itemprop="url"><span itemprop="title">错误处理</span></a></li></ol><h1 class="main__header-title">异常处理，&quot;try..catch&quot;</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="异常处理，&quot;try..catch&quot;"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>不管你多么的精通编程，有时我们的脚本总还是会有一些错误。可能是因为我们的编写出错，或是与预期不同的用户输入，或是错误的的服务端返回或者是其他总总不同的原因。</p>
<p>通常，一段代码会在出错的时候“死掉”（停止执行）并在控制台将异常打印出来。</p>
<p>但是有一种更为合理的语法结构 <code>try..catch</code>，它会在捕捉到异常的同时不会使得代码停止执行而是可以做一些更为合理的操作。</p>
<h2><a class="main__anchor" name="trycatch-yu-fa" href="#trycatch-yu-fa">“try…catch” 语法</a></h2><p><code>try..catch</code> 结构由两部分组成：<code>try</code> 和 <code>catch</code>：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {

  // 代码...

} catch (err) {

  // 异常处理

}</code></pre>
        </div>
      </div>
      
      </div><p>它按照以下步骤执行：</p>
<ol>
<li>首先，执行 <code>try {...}</code> 里面的代码。</li>
<li>如果执行过程中没有异常，那么忽略 <code>catch(err)</code> 里面的代码，<code>try</code> 里面的代码执行完之后跳出该代码块。</li>
<li>如果执行过程中发生异常，控制流就到了 <code>catch(err)</code> 的开头。变量 <code>err</code>（可以取其他任何的名称）是一个包含了异常信息的对象。</li>
</ol>
<figure><div class="image" style="width:477px">
      <div class="image__ratio" style="padding-top:82.80922431865828%"></div>
      <img src="article/try-catch/try-catch-flow.png" tppabs="https://zh.javascript.info/article/try-catch/try-catch-flow.png" alt="" width="477" height="395" class="image__image">
      </div></figure><p>所以，发生在 <code>try {…}</code> 代码块的异常不会使代码停止执行：我们可以在 <code>catch</code> 里面处理异常。</p>
<p>让我们来看更多的例子。</p>
<ul>
<li>
<p>没有异常的例子：显示下面（1）和（2）中 <code>alert</code> 的内容：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:6,&quot;cols&quot;:[{&quot;start&quot;:33,&quot;end&quot;:40}]},{&quot;start&quot;:2,&quot;cols&quot;:[{&quot;start&quot;:34,&quot;end&quot;:41}]}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {

  alert('Start of try runs');  // (1) &lt;--

  // ...这里没有异常

  alert('End of try runs');   // (2) &lt;--

} catch(err) {

  alert('Catch is ignored, because there are no errors'); // (3)

}

alert(&quot;...Then the execution continues&quot;);</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>包含异常的例子：显示下面（1）和（3）中 <code>alert</code> 的内容：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:10,&quot;cols&quot;:[{&quot;start&quot;:34,&quot;end&quot;:41}]},{&quot;start&quot;:4,&quot;end&quot;:4},{&quot;start&quot;:2,&quot;cols&quot;:[{&quot;start&quot;:34,&quot;end&quot;:41}]}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {

  alert('Start of try runs');  // (1) &lt;--

  lalala; // 异常，变量未定义！

  alert('End of try (never reached)');  // (2)

} catch(err) {

  alert(`Error has occured!`); // (3) &lt;--

}

alert(&quot;...Then the execution continues&quot;);</code></pre>
        </div>
      </div>
      
      </div></li>
</ul>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>try..catch</code> only works for runtime errors</span></div>
            <div class="important__content"><p>要使得 <code>try..catch</code> 能工作，代码必须是可执行的，换句话说，它必须是有效的 JavaScript 代码。</p>
<p>如果代码包含语法错误，那么 <code>try..catch</code> 不能正常工作，例如含有未闭合的花括号：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  {{{{{{{{{{{{
} catch(e) {
  alert(&quot;The engine can't understand this code, it's invalid&quot;);
}</code></pre>
        </div>
      </div>
      
      </div><p>JavaScript 引擎读取然后执行代码。发生在读取代码阶段的异常被称为 “parse-time” 异常，它们不会被 <code>try..catch</code> 覆盖到（包括那之间的代码）。这是因为引擎读不懂这段代码。</p>
<p>所以，<code>try..catch</code> 只能处理有效代码之中的异常。这类异常被称为 “runtime errors”，有时候也称为 “exceptions”。</p>
</div></div>
<div class="important important_warn">
            <div class="important__header"><span class="important__type"><code>try..catch</code> works synchronously</span></div>
            <div class="important__content"><p>如果一个异常是发生在计划中将要执行的代码中，例如在 <code>setTimeout</code> 中，那么 <code>try..catch</code> 不能捕捉到：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  setTimeout(function() {
    noSuchVariable; // 代码在这里停止执行
  }, 1000);
} catch (e) {
  alert( &quot;won't work&quot; );
}</code></pre>
        </div>
      </div>
      
      </div><p>因为 <code>try..catch</code> 包裹了计划要执行的 <code>setTimeout</code> 函数。但是函数本身要稍后才能执行，这时引擎已经离开了 <code>try..catch</code> 结构。</p>
<p>要捕捉到计划中将要执行的函数中的异常，那么 <code>try..catch</code> 必须在这个函数之中：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">setTimeout(function() {
  try {
    noSuchVariable; // try..catch 处理异常！
  } catch (e) {
    alert( &quot;error is caught here!&quot; );
  }
}, 1000);</code></pre>
        </div>
      </div>
      
      </div></div></div>
<h2><a class="main__anchor" name="error-dui-xiang" href="#error-dui-xiang">Error 对象</a></h2><p>当一个异常发生之后，JavaScript 生成一个包含异常细节的对象。这个对象会作为一个参数传递给 <code>catch</code>：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  // ...
} catch(err) { // &lt;-- “异常对象”，可以用其他参数名代替 err
  // ...
}</code></pre>
        </div>
      </div>
      
      </div><p>对于所有内置的异常，<code>catch</code> 代码块捕捉到的相应的异常的对象都有两个属性：</p>
<dl>
<dt><code>name</code></dt>
<dd>异常名称，对于一个未定义的变量，名称是 <code>&quot;ReferenceError&quot;</code></dd>
<dt><code>message</code></dt>
<dd>异常详情的文字描述。</dd>
</dl>
<p>还有很多非标准的属性在绝大多数环境中可用。其中使用最广泛并且被广泛支持的是：</p>
<dl>
<dt><code>stack</code></dt>
<dd>当前的调用栈：用于调试的,一个包含引发异常的嵌套调用序列的字符串。</dd>
</dl>
<p>例如：</p>
<div data-trusted="0" class="code-example" data-highlight="[{&quot;start&quot;:1,&quot;end&quot;:1}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  lalala; // 异常，变量未定义！
} catch(err) {
  alert(err.name); // ReferenceError
  alert(err.message); // lalala 未定义
  alert(err.stack); // ReferenceError: lalala 在... 中未定义

  // 可以完整的显示一个异常
  // 可以转化成 &quot;name: message&quot; 形式的字符串
  alert(err); // ReferenceError: lalala 未定义
}</code></pre>
        </div>
      </div>
      
      </div><h2><a class="main__anchor" name="shi-yong-trycatch" href="#shi-yong-trycatch">使用 “try…catch”</a></h2><p>让我们一起探究一下真实使用场景中 <code>try..catch</code> 的使用。</p>
<p>正如我们所知，JavaScript 支持 <a href="javascript:if(confirm('https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse'" tppabs="https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse(str)</a> 方法来解析 JSON 编码的值。</p>
<p>通常，它被用来解析从网络，从服务器或是从其他来源收到的数据。</p>
<p>我们收到数据后，像下面这样调用 <code>JSON.parse</code>：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:2,&quot;end&quot;:2}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{&quot;name&quot;:&quot;John&quot;, &quot;age&quot;: 30}'; // 来自服务器的数据

let user = JSON.parse(json); // 将文本表示转化成 JS 对象

// 现在 user 是一个解析自 json 字符串的有自己属性的对象
alert( user.name ); // John
alert( user.age );  // 30</code></pre>
        </div>
      </div>
      
      </div><p>你可以在 <a href="json.htm" tppabs="https://zh.javascript.info/json">JSON 方法，toJSON</a> 这章找到更多的关于 JSON 的详细信息。</p>
<p><strong>如果 <code>json</code> 格式错误，<code>JSON.parse</code> 就会报错，代码就会停止执行。</strong></p>
<p>得到报错之后我们就应该满意了吗？当然不！</p>
<p>如果这样做，当拿到的数据出错，用户就不会知道（除非他们打开开发者控制台）。代码执行失败却没有提示信息会导致糟糕的用户体验。</p>
<p>让我们来用 <code>try..catch</code> 来处理这个错误：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:8,&quot;end&quot;:11},{&quot;start&quot;:4,&quot;end&quot;:4}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = &quot;{ bad json }&quot;;

try {

  let user = JSON.parse(json); // &lt;-- 当这里抛出异常...
  alert( user.name ); // 不工作

} catch (e) {
  // ...跳到这里继续执行
  alert( &quot;Our apologies, the data has errors, we'll try to request it one more time.&quot; );
  alert( e.name );
  alert( e.message );
}</code></pre>
        </div>
      </div>
      
      </div><p>我们用 <code>catch</code> 代码块来展示信息，但是我们可以做的更多：发送一个新的网络请求，给用户提供另外的选择，把异常信息发送给记录日志的工具，… 。所有这些都比让代码直接停止执行好的多。</p>
<h2><a class="main__anchor" name="pao-chu-zi-ding-yi-de-yi-chang" href="#pao-chu-zi-ding-yi-de-yi-chang">抛出自定义的异常</a></h2><p>如果这个 <code>json</code> 数据语法正确，但是少了我们需要的 <code>name</code> 属性呢？</p>
<p>像这样：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:5,&quot;end&quot;:5}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ &quot;age&quot;: 30 }'; // 不完整的数据

try {

  let user = JSON.parse(json); // &lt;-- 不抛出异常
  alert( user.name ); // 没有 name!

} catch (e) {
  alert( &quot;doesn't execute&quot; );
}</code></pre>
        </div>
      </div>
      
      </div><p>这里 <code>JSON.parse</code> 正常执行，但是缺少 <code>name</code> 属性对我们来说确实是个异常。</p>
<p>为了统一的异常处理，我们会使用 <code>throw</code> 运算符。</p>
<h3><a class="main__anchor" name="throw-yun-suan-fu" href="#throw-yun-suan-fu">“Throw” 运算符</a></h3><p><code>throw</code> 运算符生成异常对象。</p>
<p>语法如下：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">throw &lt;error object&gt;</code></pre>
        </div>
      </div>
      
      </div><p>技术上讲，我们可以使用任何东西来作为一个异常对象。甚至可以是基础类型，比如数字或者字符串。但是更好的方式是用对象，尤其是有 <code>name</code> 和 <code>message</code> 属性的对象（某种程度上和内置的异常有可比性）。</p>
<p>JavaScript 有很多标准异常的内置的构造器：<code>Error</code>、 <code>SyntaxError</code>、<code>ReferenceError</code>、<code>TypeError</code> 和其他的。我们也可以用他们来创建异常对象。</p>
<p>他们的语法是：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let error = new Error(message);
// 或者
let error = new SyntaxError(message);
let error = new ReferenceError(message);
// ...</code></pre>
        </div>
      </div>
      
      </div><p>对于内置的异常对象（不是对于其他的对象，而是对于异常对象），<code>name</code> 属性刚好是构造器的名字。<code>message</code> 则来自于参数。</p>
<p>例如：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let error = new Error(&quot;Things happen o_O&quot;);

alert(error.name); // Error
alert(error.message); // Things happen o_O</code></pre>
        </div>
      </div>
      
      </div><p>让我们来看看 <code>JSON.parse</code> 会生成什么样的错误：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:3,&quot;end&quot;:3}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  JSON.parse(&quot;{ bad json o_O }&quot;);
} catch(e) {
  alert(e.name); // SyntaxError
  alert(e.message); // Unexpected token o in JSON at position 0
}</code></pre>
        </div>
      </div>
      
      </div><p>如我们所见， 那是一个  <code>SyntaxError</code>。</p>
<p>假定用户必须有一个 <code>name</code> 属性，在我们看来，该属性的缺失也可以看作语法问题。</p>
<p>所以，让我们抛出这个异常。</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:7,&quot;end&quot;:7}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ &quot;age&quot;: 30 }'; // 不完整的数据

try {

  let user = JSON.parse(json); // &lt;-- 没有异常

  if (!user.name) {
    抛出 new SyntaxError(&quot;Incomplete data: no name&quot;); // (*)
  }

  alert( user.name );

} catch(e) {
  alert( &quot;JSON Error: &quot; + e.message ); // JSON Error: Incomplete data: no name
}</code></pre>
        </div>
      </div>
      
      </div><p>在 <code>(*)</code> 标记的这一行，<code>throw</code> 操作符生成了包含着我们所给的 <code>message</code> 的 <code>SyntaxError</code>，就如同 JavaScript 自己生成的一样。<code>try</code> 里面的代码执行停止，控制权转交到 <code>catch</code> 代码块。</p>
<p>现在 <code>catch</code> 代码块成为了处理包括 <code>JSON.parse</code> 在内和其他所有异常的地方。</p>
<h2><a class="main__anchor" name="zai-ci-pao-chu-yi-chang" href="#zai-ci-pao-chu-yi-chang">再次抛出异常</a></h2><p>上面的例子中，我们用 <code>try..catch</code> 处理没有被正确返回的数据，但是也有可能在 <code>try {...}</code> 代码块内发生<strong>另一个预料之外的</strong>异常，例如变量未定义或者其他不是返回的数据不正确的异常。</p>
<p>例如：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ &quot;age&quot;: 30 }'; // 不完整的数据

try {
  user = JSON.parse(json); // &lt;-- 忘了在 user 前加 &quot;let&quot;

  // ...
} catch(err) {
  alert(&quot;JSON Error: &quot; + err); // JSON Error: ReferenceError: user is not defined
  // ( 实际上并没有 JSON Error)
}</code></pre>
        </div>
      </div>
      
      </div><p>当然，一切皆有可能。程序员也是会犯错的。即使是一些开源的被数百万人用了几十年的项目 —— 一个严重的 bug 因为他引发的严重的黑客事件被发现（比如发生在 <code>ssh</code> 工具上的黑客事件）。</p>
<p>对我们来说，<code>try..catch</code> 是用来捕捉“数据错误”的异常，但是 catch 本身会捕捉到<strong>所有</strong>来自于 <code>try</code> 的异常。这里，我们遇到了预料之外的错误，但是仍然抛出了 <code>&quot;JSON Error&quot;</code> 的信息，这是不正确的，同时也会让我们的代码变得更难调试。</p>
<p>幸运的是，我们可以通过其他方式找出这个异常，例如通过它的 <code>name</code> 属性：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:3,&quot;end&quot;:3}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  user = { /*...*/ };
} catch(e) {
  alert(e.name); // &quot;ReferenceError&quot; for accessing an undefined variable
}</code></pre>
        </div>
      </div>
      
      </div><p>规则很简单：</p>
<p><strong><code>catch</code> 应该只捕获已知的异常，而重新抛出其他的异常。</strong></p>
<p>“rethrowing” 技术可以被更详细的理解为：</p>
<ol>
<li>捕获全部异常。</li>
<li>在 <code>catch(err) {...}</code> 代码块，我们分析异常对象 <code>err</code>。</li>
<li>如果我们不知道如何处理它，那我们就做 <code>throw err</code> 操作。</li>
</ol>
<p>在下面的代码中，为了达到只在 <code>catch</code> 代码块处理 <code>SyntaxError</code> 的目的，我们使用重新抛出的方法：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:15,&quot;end&quot;:19},{&quot;start&quot;:9,&quot;end&quot;:9}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let json = '{ &quot;age&quot;: 30 }'; // 不完整的数据
try {

  let user = JSON.parse(json);

  if (!user.name) {
    throw new SyntaxError(&quot;Incomplete data: no name&quot;);
  }

  blabla(); // 预料之外的异常

  alert( user.name );

} catch(e) {

  if (e.name == &quot;SyntaxError&quot;) {
    alert( &quot;JSON Error: &quot; + e.message );
  } else {
    throw e; // rethrow (*)
  }

}</code></pre>
        </div>
      </div>
      
      </div><p><code>(*)</code> 标记的这行从 <code>catch</code> 代码块抛出的异常，是独立于我们期望捕获的异常之外的，它也能被它外部的 <code>try..catch</code> 捕捉到（如果存在该代码块的话），如果不存在，那么代码会停止执行。</p>
<p>所以，<code>catch</code> 代码块只处理已知如何处理的异常，并且跳过其他的异常。</p>
<p>下面这段代码将演示，这种类型的异常如何被另外一层 <code>try..catch</code> 代码捕获。</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:17,&quot;end&quot;:17},{&quot;start&quot;:9,&quot;end&quot;:9},{&quot;start&quot;:5,&quot;end&quot;:5}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function readData() {
  let json = '{ &quot;age&quot;: 30 }';

  try {
    // ...
    blabla(); // 异常！
  } catch (e) {
    // ...
    if (e.name != 'SyntaxError') {
      throw e; //  重新抛出（不知道如何处理它）
    }
  }
}

try {
  readData();
} catch (e) {
  alert( &quot;External catch got: &quot; + e ); // 捕获到！
}</code></pre>
        </div>
      </div>
      
      </div><p>例子中的 <code>readData</code> 只能处理 <code>SyntaxError</code>，而外层的 <code>try..catch</code> 能够处理所有的异常。</p>
<h2><a class="main__anchor" name="trycatchfinally" href="#trycatchfinally">try…catch…finally</a></h2><p>然而，这并不是全部。</p>
<p><code>try..catch</code> 还有另外的语法：<code>finally</code>。</p>
<p>如果它有被使用，那么，所有条件下都会执行：</p>
<ul>
<li><code>try</code> 之后，如果没有异常。</li>
<li><code>catch</code> 之后，如果没有异常。</li>
</ul>
<p>该扩展语法如下所示：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:4,&quot;cols&quot;:[{&quot;start&quot;:2,&quot;end&quot;:9}]},{&quot;start&quot;:2,&quot;cols&quot;:[{&quot;start&quot;:2,&quot;end&quot;:7}]},{&quot;start&quot;:0,&quot;cols&quot;:[{&quot;start&quot;:0,&quot;end&quot;:3}]}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
   ... 尝试执行的代码 ...
} catch(e) {
   ... 异常处理 ...
} finally {
   ... 最终会执行的代码 ...
}</code></pre>
        </div>
      </div>
      
      </div><p>试试运行这段代码：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  alert( 'try' );
  if (confirm('Make an error?')) BAD_CODE();
} catch (e) {
  alert( 'catch' );
} finally {
  alert( 'finally' );
}</code></pre>
        </div>
      </div>
      
      </div><p>这段代码有两种执行方式：</p>
<ol>
<li>如果对于 “Make an error?” 你的回答是 “Yes”，那么执行 <code>try -&gt; catch -&gt; finally</code>。</li>
<li>如果你的回答是 “No”，那么执行 <code>try -&gt; finally</code>。</li>
</ol>
<p><code>finally</code> 的语法通常用在：我们在 <code>try..catch</code> 之前开始一个操作，不管在该代码块中执行的结果怎样，我们都想结束的时候执行某个操作。</p>
<p>比如，生成斐波那契数的函数 <code>fib(n)</code> 的执行时间，通常，我们在开始和结束的时候测量。但是，如果该函数在被调用的过程中发生异常，就如执行下面的代码就会返回负数或者非整数的异常。</p>
<p>任何情况下，<code>finally</code> 代码块就是一个很好的结束测量的地方。</p>
<p>这里，不管前面的代码正确执行，或者抛出异常，<code>finally</code> 都保证了正确的时间测量。</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:17,&quot;end&quot;:19}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let num = +prompt(&quot;Enter a positive integer number?&quot;, 35)

let diff, result;

function fib(n) {
  if (n &lt; 0 || Math.trunc(n) != n) {
    throw new Error(&quot;Must not be negative, and also an integer.&quot;);
  }
  return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2);
}

let start = Date.now();

try {
  result = fib(num);
} catch (e) {
  result = 0;
} finally {
  diff = Date.now() - start;
}

alert(result || &quot;error occured&quot;);

alert( `execution took ${diff}ms` );</code></pre>
        </div>
      </div>
      
      </div><p>你可以通过后面的不同的输入来检验上面代码的执行：先在 <code>prompt</code> 弹框中先输入 <code>35</code> —— 它会正常执行，<code>try</code> 代码执行后执行 <code>finally</code> 里面的代码。然后再输入 <code>-1</code>，会立即捕获一个异常，执行时间将会是 <code>0ms</code>。两次的测量结果都是正确的。</p>
<p>换句话说，有两种方式退出这个函数的执行：<code>return</code> 或是 <code>throw</code>，<code>finally</code> 语法都能处理。</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Variables are local inside <code>try..catch..finally</code></span></div>
            <div class="important__content"><p>请注意：上面代码中的 <code>result</code> 和 <code>diff</code> 变量，都需要在 <code>try..catch</code> <strong>之前</strong>声明。</p>
<p>否则，如果用 <code>let</code> 在 <code>{...}</code> 代码块里声明，那么只能在该代码块访问到。</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>finally</code> and <code>return</code></span></div>
            <div class="important__content"><p><code>finally</code> 语法支持<strong>任何</strong>的结束 <code>try..catch</code> 执行的方式，包括明确的 <code>return</code>。</p>
<p>下面就是 <code>try</code> 代码块包含 <code>return</code> 的例子。在代码执行的控制权转移到外部代码之前，<code>finally</code> 代码块会被执行。</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:8,&quot;end&quot;:8},{&quot;start&quot;:3,&quot;end&quot;:3}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function func() {

  try {
    return 1;

  } catch (e) {
    /* ... */
  } finally {
    alert( 'finally' );
  }
}

alert( func() ); // 先 alert &quot;finally&quot; 里面的内容，再执行这里</code></pre>
        </div>
      </div>
      
      </div></div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>try..finally</code></span></div>
            <div class="important__content"><p><code>try..finally</code> 结构也很有用，当我们希望确保代码执行完成不想在这里处理异常时，我们会使用这种结构。</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function func() {
  // 开始做需要被完成的操作（比如测量）
  try {
    // ...
  } finally {
    // 完成前面要做的事情，即使 try 里面执行失败
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>上面的代码中，由于没有 <code>catch</code>，<code>try</code> 代码块中的异常会跳出这块代码的执行。但是，在跳出之前 <code>finally</code> 里面的代码会被执行。</p>
</div></div>
<h2><a class="main__anchor" name="quan-ju-catch" href="#quan-ju-catch">全局 catch</a></h2><div class="important important_warn">
            <div class="important__header"><span class="important__type">Environment-specific</span></div>
            <div class="important__content"><p>这个部分的内容并不是 JavaScript 核心的一部分。</p>
</div></div>
<p>设想一下，<code>try..catch</code> 之外出现了一个严重的异常，代码停止执行，可能是因为编程异常或者其他更严重的异常。</p>
<p>那么，有没办法来应对这种情况呢？我们希望记录这个异常，给用户一些提示信息（通常，用户是看不到提示信息的），或者做一些其他操作。</p>
<p>虽然没有这方面的规范，但是代码的执行环境一般会提供这种机制，因为这真的很有用。例如，Node.JS 有 <a href="javascript:if(confirm('https://nodejs.org/api/process.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://nodejs.org/api/process.html#process_event_uncaughtexception'" tppabs="https://nodejs.org/api/process.html#process_event_uncaughtexception">process.on(‘uncaughtException’)</a> 。对于浏览器环境，我们可以绑定一个函数到 <a href="javascript:if(confirm('https://developer.mozilla.org/zh/docs/Web/API/GlobalEventHandlers/onerror  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://developer.mozilla.org/zh/docs/Web/API/GlobalEventHandlers/onerror'" tppabs="https://developer.mozilla.org/zh/docs/Web/API/GlobalEventHandlers/onerror">window.onerror</a>，当遇到未知异常的时候，它就会执行。</p>
<p>语法如下：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.onerror = function(message, url, line, col, error) {
  // ...
};</code></pre>
        </div>
      </div>
      
      </div><dl>
<dt><code>message</code></dt>
<dd>异常信息。</dd>
<dt><code>url</code></dt>
<dd>发生异常的代码的 URL。</dd>
<dt><code>line</code>, <code>col</code></dt>
<dd>错误发生的代码的行号和列号。</dd>
<dt><code>error</code></dt>
<dd>异常对象。</dd>
</dl>
<p>例如：</p>
<div data-trusted="0" class="code-example" data-demo-height="1" data-refresh="1" data-highlight="[{&quot;start&quot;:1,&quot;end&quot;:3}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="展示" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;script&gt;
  window.onerror = function(message, url, line, col, error) {
    alert(`${message}\n At ${line}:${col} of ${url}`);
  };

  function readData() {
    badFunc(); // 哦，出问题了！
  }

  readData();
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p><code>window.onerror</code> 的目的不是去处理整个代码的执行中的所有异常 —— 这几乎是不可能的，这只是为了给开发者提供异常信息。</p>
<p>也有针对这种情况提供异常日志的 web 服务，比如 <a href="javascript:if(confirm('https://errorception.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://errorception.com/'" tppabs="https://errorception.com/">https://errorception.com</a> 或者 <a href="javascript:if(confirm('http://www.muscula.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.muscula.com/'" tppabs="http://www.muscula.com/">http://www.muscula.com</a>。</p>
<p>它们会这样运行：</p>
<ol>
<li>我们注册这个服务，拿到一段 JS 代码（或者代码的 URL），然后插入到页面中。</li>
<li>这段 JS 代码会有一个客户端的 <code>window.onerror</code> 函数。</li>
<li>发生异常时，它会发送一个异常相关的网络请求到服务提供方。</li>
<li>我们只要登录服务方提供方的网络接口就可以看到这些异常。</li>
</ol>
<h2><a class="main__anchor" name="zong-jie" href="#zong-jie">总结</a></h2><p><code>try..catch</code> 结构允许我们处理执行时的异常，它允许我们尝试执行代码，并且捕获执行过程中可能发生的异常。</p>
<p>语法如下：</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  // 执行此处代码
} catch(err) {
  // 如果发生异常，跳到这里
  // err 是一个异常对象
} finally {
  // 不管 try/catch 怎样都会执行
}</code></pre>
        </div>
      </div>
      
      </div><p>可能会没有 <code>catch</code> 代码块，或者没有 <code>finally</code> 代码块。所以 <code>try..catch</code> 或者 <code>try..finally</code> 都是可用的。</p>
<p>异常对象包含下列属性：</p>
<ul>
<li><code>message</code> —— 我们能阅读的异常提示信息。</li>
<li><code>name</code> —— 异常名称（异常对象的构造函数的名称）。</li>
<li><code>stack</code>（没有标准） —— 异常发生时的调用栈。</li>
</ul>
<p>我们也可以通过使用 <code>throw</code> 运算符来生成自定义的异常。技术上来讲，<code>throw</code> 的参数没有限制，但是通常它是一个继承自内置的 <code>Error</code> 类的异常对象。更对关于异常的扩展，请看下个章节。</p>
<p>重新抛出异常，是一种异常处理的基本模式：<code>catch</code> 代码块通常处理某种已知的特定类型的异常，所以它应该抛出其他未知类型的异常。</p>
<p>即使我们没有使用 <code>try..catch</code>，绝大多数执行环境允许我们设置全局的异常处理机制来捕获出现的异常。浏览器中，就是 <code>window.onerror</code>。</p>
</div></article><div class="tasks formatted"><h2 class="tasks__title" id="tasks"><a class="tasks__title-anchor main__anchor main__anchor main__anchor_noicon" href="#tasks">任务</a></h2><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="#zai-finally-zhong-zhi-hang-huan-shi-zai-zhi-jie-fang-zai-dai-ma-hou-mian" name="zai-finally-zhong-zhi-hang-huan-shi-zai-zhi-jie-fang-zai-dai-ma-hou-mian">在 `finally` 中执行，还是在直接放在代码后面</a></h3><a class="task__open-link" href="task/finally-or-code-after.htm" tppabs="https://zh.javascript.info/task/finally-or-code-after" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="任务的重要程度有多高，等级从 1 到 5。">重要程度: 5</span></div><div class="task__content"><p>比较下面两个代码片段。</p>
<ol>
<li>
<p>用 <code>finally</code> 执行 <code>try..catch</code> 之后的代码：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:5,&quot;end&quot;:5}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  work work
} catch (e) {
  handle errors
} finally {
  cleanup the working space
}</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>第二个代码片段，把清空工作空间的代码放在 <code>try..catch</code> 之后，但并不包裹在 <code>finally</code> 里面。</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:6,&quot;end&quot;:6}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">try {
  work work
} catch (e) {
  handle errors
}

cleanup the working space</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>我们只是需要在代码执行完之后，清除工作空间，而不管是不是在执行的过程中遇到异常。</p>
<p>那么，是用 <code>finally</code> 好呢还是两种方式都一样？如果哪种更好，请举例说明在什么情况下它会更好？</p>
<button class="task__solution" type="button">解决方案</button><div class="task__answer"><div class="task__answer-content"><p>当我们看下面这个函数里面的代码，差异就很明显了。</p>
<p>如果能够跳出 <code>try..catch</code>，表现就不同了。</p>
<p>例如，当 <code>try..catch</code> 里有 <code>return</code> 的时候，<code>finally</code> 代码块会在退出 <code>try..catch</code> 后继续执行，即使是通过 <code>return</code> 语句退出的。它会在再后面的代码执行之前，在 <code>try..catch</code> 执行完之后立即执行。</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:3,&quot;end&quot;:3}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  try {
    alert('start');
    return &quot;result&quot;;
  } catch (e) {
    /// ...
  } finally {
    alert('cleanup!');
  }
}

f(); // cleanup!</code></pre>
        </div>
      </div>
      
      </div><p>…或者当有 <code>throw</code> 的时候，如下：</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:7,&quot;end&quot;:7}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="运行" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="在沙箱中打开" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f() {
  try {
    alert('start');
    throw new Error(&quot;an error&quot;);
  } catch (e) {
    // ...
    if(&quot;can't handle the error&quot;) {
      throw e;
    }

  } finally {
    alert('cleanup!')
  }
}

f(); // cleanup!</code></pre>
        </div>
      </div>
      
      </div><p>正是这里的 <code>finally</code> 代码块保证了 <code>cleanup</code> 的显示，但是如果把 <code>finally</code> 里面的这行代码放在函数 <code>f</code> 的最后，那么，它不会执行。</p>
</div><button class="close-button task__answer-close" type="button" title="关闭"></button></div></div></div></div></div></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="error-handling.htm" tppabs="https://zh.javascript.info/error-handling" data-tooltip="错误处理"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">上一节</span></a><a class="page__nav page__nav_next" href="custom-errors.htm" tppabs="https://zh.javascript.info/custom-errors" data-tooltip="自定义错误及扩展错误"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">下一节</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">分享</span><a class="share share_tw" href="javascript:if(confirm('https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_fb" href="javascript:if(confirm('https://www.facebook.com/sharer/sharer.php?s=100&p%5Burl%5D=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.facebook.com/sharer/sharer.php?s=100&p%5Burl%5D=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://www.facebook.com/sharer/sharer.php?s=100&p%5Burl%5D=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_gp" href="javascript:if(confirm('https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_vk" href="javascript:if(confirm('https://vkontakte.ru/share.php?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://vkontakte.ru/share.php?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://vkontakte.ru/share.php?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a></div><div class="article-tablet-foot__map"><a class="map" href="tutorial/map.htm" tppabs="https://zh.javascript.info/tutorial/map" data-action="tutorial-map"><span class="map__text">教程路线图</span></a></div></div></div><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">评论</a></h2><div class="comments__read-before"><span class="comments__read-before-link">在评论之前先阅读本内容…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>欢迎你在文章下添加补充内容、提出你的问题或回答提出的问题。</li><li>使用 <code>&lt;code&gt;</code> 标签插入几行代码，对于多行代码 — 可以使用 <code>&lt;pre&gt;</code>，对于超过十行的代码 — 建议使用沙箱（<a href="javascript:if(confirm('http://plnkr.co/edit/?p=preview  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://plnkr.co/edit/?p=preview'" tppabs="http://plnkr.co/edit/?p=preview">plnkr</a>、<a href="javascript:if(confirm('http://jsbin.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://jsbin.com/'" tppabs="http://jsbin.com/">JSBin</a> 和 <a href="javascript:if(confirm('http://codepen.io/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://codepen.io/'" tppabs="http://codepen.io/">codepen</a> 等）。</li><li>如果你无法理解文章中的内容 — 请详细说明。</li></ul></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/zh.javascript.info\/try-catch","identifier":"\/try-catch"}); };</script><script>var disqus_shortname = "zh-javascript-info";</script><script>var disqus_enabled = true;</script></div></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="tutorial/map.htm" tppabs="https://zh.javascript.info/tutorial/map" data-action="tutorial-map" data-tooltip="教程路线图"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">章节</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="error-handling.htm" tppabs="https://zh.javascript.info/error-handling">错误处理</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">课程导航</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#trycatch-yu-fa">“try…catch” 语法</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#error-dui-xiang">Error 对象</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#shi-yong-trycatch">使用 “try…catch”</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#pao-chu-zi-ding-yi-de-yi-chang">抛出自定义的异常</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#zai-ci-pao-chu-yi-chang">再次抛出异常</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#trycatchfinally">try…catch…finally</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#quan-ju-catch">全局 catch</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#zong-jie">总结</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#tasks">任务 (1)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#comments">评论</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">分享</div><a class="share share_tw sidebar__share" href="javascript:if(confirm('https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://twitter.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_fb sidebar__share" href="javascript:if(confirm('https://www.facebook.com/sharer/sharer.php?s=100&p[url]=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://www.facebook.com/sharer/sharer.php?s=100&p[url]=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://www.facebook.com/sharer/sharer.php?s=100&p[url]=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a><a class="share share_gp sidebar__share" href="javascript:if(confirm('https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch'" tppabs="https://plus.google.com/share?url=http%3A%2F%2Fzh.javascript.info%2Ftry-catch"></a></div><div class="sidebar__section"><a class="sidebar__link" href="javascript:if(confirm('https://github.com/xitu/javascript-tutorial-zh/blob/zh-hans/1-js/08-error-handling/1-try-catch/article.md  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://github.com/xitu/javascript-tutorial-zh/blob/zh-hans/1-js/08-error-handling/1-try-catch/article.md'" tppabs="https://github.com/xitu/javascript-tutorial-zh/blob/zh-hans/1-js/08-error-handling/1-try-catch/article.md">在 Github 上编辑</a></div></div></div></div></div></div><div class="page-footer"><div class="page-footer__left"><ul class="page-footer__list"><li class="page-footer__item">©&nbsp;2007—2018&nbsp; Ilya Kantor</li><li class="page-footer__item"><a class="page-footer__link" href="about.htm#contact-us" tppabs="https://zh.javascript.info/about#contact-us">联系我们</a></li><li class="page-footer__item"><a class="page-footer__link" href="about.htm" tppabs="https://zh.javascript.info/about">关于本项目</a></li></ul></div><div class="page-footer__right"><ul class="page-footer__list"><li><a class="page-footer__link" rel="nofollow" href="javascript:if(confirm('http://github.com/iliakan/javascript-tutorial-zh  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://github.com/iliakan/javascript-tutorial-zh'" tppabs="http://github.com/iliakan/javascript-tutorial-zh">open source</a></li></ul></div></div></body></html>